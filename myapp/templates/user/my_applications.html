<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Applications | InternConnect</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #0f172a; --accent: #2563eb; }
        body { font-family: 'Segoe UI', sans-serif; background: #f8fafc; margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; display: grid; grid-template-columns: 250px 1fr; gap: 30px; }

        /* SIDEBAR */
        .sidebar { background: white; padding: 20px; border-radius: 12px; height: fit-content; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .menu-item { display: flex; align-items: center; gap: 10px; padding: 12px; color: #64748b; text-decoration: none; border-radius: 8px; margin-bottom: 5px; transition: 0.2s; }
        .menu-item:hover, .menu-item.active { background: #eff6ff; color: var(--accent); font-weight: 600; }

        /* TRACKER CARD */
        .app-card { background: white; border-radius: 12px; padding: 25px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .app-header { display: flex; justify-content: space-between; border-bottom: 1px solid #f1f5f9; padding-bottom: 15px; margin-bottom: 20px; }
        .company-info h3 { margin: 0; color: #1e293b; font-size: 1.2rem; }
        .company-info p { margin: 2px 0 0; color: #64748b; font-size: 0.9rem; }

        /* TIMELINE */
        .timeline { display: flex; justify-content: space-between; position: relative; margin: 0 20px; }
        .timeline::before {
            content: ''; position: absolute; top: 15px; left: 0; width: 100%; height: 3px; background: #e2e8f0; z-index: 0;
        }
        .step { position: relative; z-index: 1; text-align: center; width: 100px; }
        .circle {
            width: 30px; height: 30px; background: white; border: 3px solid #cbd5e1; border-radius: 50%; margin: 0 auto 10px;
            display: flex; align-items: center; justify-content: center; font-weight: bold; color: #64748b; transition: 0.3s;
        }
        .step-label { font-size: 0.8rem; color: #94a3b8; font-weight: 600; }

        /* ACTIVE STATES */
        .step.active .circle { border-color: var(--accent); background: var(--accent); color: white; }
        .step.active .step-label { color: var(--accent); }
        .step.completed .circle { border-color: #10b981; background: #10b981; color: white; }
        .step.rejected .circle { border-color: #ef4444; background: #ef4444; color: white; }

        .action-area { margin-top: 25px; background: #f8fafc; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0; }
        .btn-action { display: inline-block; background: var(--accent); color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none; font-size: 0.9rem; font-weight: 600; }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h3 style="margin-top:0; color:#3b82f6;">InternConnect</h3>
            <a href="{% url 'user_dashboard' %}" class="menu-item"><i class="fas fa-th-large"></i> Dashboard</a>
            <a href="#" class="menu-item active"><i class="fas fa-briefcase"></i> My Applications</a>
            <a href="{% url 'browse_internships' %}" class="menu-item"><i class="fas fa-search"></i> Browse Jobs</a>
            <a href="{% url 'my_notifications' %}" class="menu-item"><i class="fas fa-bell"></i> Notifications</a>
            <a href="{% url 'logout' %}" class="menu-item" style="color:#ef4444; margin-top:20px;">Logout</a>
        </div>

        <div class="content">
            <h1 style="color:#1e293b; margin-top:0;">Track Applications</h1>

            {% for app in apps %}
            <div class="app-card">
                <div class="app-header">
                    <div class="company-info">
                        <h3>{{ app.internship.positionTitle }}</h3>
                        <p><i class="fas fa-building"></i> {{ app.internship.company.company_name }}</p>
                    </div>
                    <div style="text-align:right;">
                        <span style="font-size:0.85rem; color:#64748b;">Applied: {{ app.EarliestStartDate }}</span>
                    </div>
                </div>

                <div class="timeline">
                    <!-- Step 1: Applied -->
                    <div class="step completed">
                        <div class="circle"><i class="fas fa-check"></i></div>
                        <div class="step-label">Applied</div>
                    </div>

                    <!-- Step 2: Interview -->
                    <div class="step {% if app.Status == 'Interview Scheduled' or app.Status == 'Approved' or app.Status == 'Completed' %}active{% endif %}">
                        <div class="circle">2</div>
                        <div class="step-label">Interview</div>
                    </div>

                    <!-- Step 3: Selected -->
                    <div class="step {% if app.Status == 'Approved' or app.Status == 'Completed' %}active{% endif %} {% if app.Status == 'Rejected' %}rejected{% endif %}">
                        <div class="circle">3</div>
                        <div class="step-label">{% if app.Status == 'Rejected' %}Rejected{% else %}Selected{% endif %}</div>
                    </div>

                    <!-- Step 4: Completed -->
                    <div class="step {% if app.Status == 'Completed' %}completed{% endif %}">
                        <div class="circle"><i class="fas fa-flag"></i></div>
                        <div class="step-label">Completed</div>
                    </div>
                </div>

                {% if app.Status == 'Interview Scheduled' %}
                <div class="action-area">
                    <strong>Next Step:</strong> Interview Scheduled on {{ app.interview_date }}
                    <a href="{{ app.interview_link }}" target="_blank" class="btn-action" style="float:right;">Join Meeting</a>
                </div>
                {% elif app.Status == 'Approved' %}
                <div class="action-area">
                    <strong>Action:</strong> Project Assigned. <a href="{% url 'project_workspace' app.id %}">Go to Workspace</a>
                </div>
                {% elif app.Status == 'Completed' and app.certificate %}
                <div class="action-area">
                    <strong style="color:#10b981;">Success!</strong> You have completed this internship.
                    <a href="{{ app.certificate.url }}" target="_blank" class="btn-action" style="float:right; background:#f59e0b;">Download Certificate</a>
                </div>
                {% endif %}
            </div>
            {% empty %}
            <div style="text-align:center; padding:50px; color:#94a3b8;">
                <i class="fas fa-folder-open" style="font-size:3rem;"></i>
                <p>No active applications.</p>
            </div>
            {% endfor %}
        </div>
    </div>
</body>
</html>